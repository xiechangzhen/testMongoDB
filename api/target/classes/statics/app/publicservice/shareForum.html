<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>社区动态</title>

    <link rel="stylesheet" type="text/css" href="css/swiper.min.css">
    <link rel="stylesheet" type="text/css" href="css/iconfont.css" />
      <link rel="stylesheet" type="text/css" href="css/aui.css">
    <style>
        * {
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        body {
            line-height: 1.5;
            font-size: 0.8rem;
            margin: 0px;
            padding: 0px;
            background-color: #FFFFFF;
        }

        header table {
            text-align: center;
        }

        .header {
            background-color: #525252;
            width: 100%;
        }

        .middle_outer {
            position: absolute !important;
            position: relative;
            top: 48px !important;
            /*header部分的高度*/
            top: 0;
            bottom: 52px;
            /*footer部分的高度*/
            width: 100%;
            overflow: hidden;
            /*外层div不滚动，而是内层div滚动，实现自适应*/
            height: auto !important;
            height: 100%;
        }

        .middle_inner {
            height: 100%;
            overflow-y: auto;
            /*当内容超出后，就会出现滚动条*/
        }

        .swiper-container {
            width: 100%;
            height: 248px;
        }

        .swiper-slide {
            text-align: center;
            font-size: 18px;
            background: #fff;
            /* Center slide text vertically */
            display: -webkit-box;
            display: -ms-flexbox;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-box-align: center;
            -ms-flex-align: center;
            -webkit-align-items: center;
            align-items: center;
        }

        .slideImage {
            width: 100%;
            height: 100%;
        }

        .mask {
            height: 20px;
            position: absolute;
            bottom: 0px;
            z-index: 9;
            background-color: #000000;
            opacity: 0.4;
            width: 100%;
        }

        .slide-num {
            text-align: right;
            color: white;
            font-size: 12px;
            bottom: 0px;
            line-height: 20px;
            width: 95%;
        }

        .read-num {
            color: white;
            font-size: 11px;
            position: absolute;
            z-index: 10;
            bottom: 0px;
            line-height: 20px;
            left: 5%;
        }

        .profile {
            width: 34px;
            height: 34px;
            border-radius: 17px;
        }

        .commentProfile {
            width: 26px;
            height: 26px;
            border-radius: 13px;
        }

        .userName {
            text-align: left;
            font-size: 14px;
            color: #282828;
            font-family: '微软雅黑';
        }

        .follow {
            display: inline-block;
            border: 1px #409aff solid;
            border-radius: 4px;
            color: #409aff;
            font-size: 12px;
            font-family: '微软雅黑';
            width: 40px;
            text-align: center;
            padding: 1px 0;
        }

        .followed {
            border: 1px #989898 solid;
            border-radius: 4px;
            color: #989898;
            font-size: 12px;
            font-family: '微软雅黑';
            width: 40px;
            text-align: center;
            padding: 1px 0;
        }

        .slogan {
            font-family: '微软雅黑';
            color: #FFFFFF;
            font-size: 16px;
        }

        .font01 {
            font-size: 12px;
            color: #656565;
            font-family: '微软雅黑';
        }

        .font02 {
            font-size: 12px;
            color: #282828;
            font-family: '微软雅黑';
            line-height: 36px;
        }

        .font03 {
            font-size: 12px;
            color: #FFFFFF;
            font-family: '微软雅黑';
        }

        .date {
            font-size: 10px;
            color: #989898;
            font-family: '微软雅黑';
        }

        .seperator {
            width: 100%;
            background-color: #DDDDDD;
            height: 8px;
            margin-top: 10px;
        }

        .replyDiv {
            width: 100%;
            background-color: #F2F2F2;
            padding-top: 6px;
            padding-bottom: 4px;
        }

        .reply {
            font-size: 10px;
            color: #656565;
            font-family: '微软雅黑';
            margin-left: 13px;
        }

        .showAll {
            font-size: 10px;
            color: #409aff;
            font-family: '微软雅黑';
            margin-left: 13px;
        }

        .bottomDiv {
            height: 48px;
            width: 100%;
            background-color: #303030;
            padding-top: 9px;
            position: fixed;
            bottom: 0px;
        }

        .reportFont {
            font-size: 12px;
            color: #FFFFFF;
        }
        /*立即下载样式*/

        .btn01 {
            font-family: '微软雅黑';
            color: #FFFFFF;
            font-size: 12px;
            border-radius: 5px;
            background-color: #409aff;
            padding: 6px 8px;
        }

        .btn02 {
            margin: 0 16px;
            font-family: '微软雅黑';
            color: #fffefe;
            font-size: 16px;
            border-radius: 5px;
            background-color: #409aff;
            height: 36px;
            line-height: 36px;
            text-align: center;
        }

        .bottom {
            position: fixed;
            width: 100%;
            bottom: 16px;
        }
    </style>
</head>

<body>
    <div class="header" style="padding:8px 16px;">
        <table border="0" cellspacing="0" cellpadding="0" style="width:100%;">
            <tr>
                <td width="32px"><img src="./image/logo02.png" style="width:100%;height:32px;" /></td>
                <td width="15px;">&nbsp;</td>
                <td><span class="slogan">体育让梦想成真</span></td>
                <td width="30%" align="right"><span class="btn01" onClick="downloadapp();">立即下载</span></td>
            </tr>
        </table>
    </div>
    <div class='middle_outer'>
        <div class='middle_inner'>
            <div id="basicInfo">
            </div>
            <div id="commentDiv" style="background-color:#FFFFFF;margin-bottom:10px;">
            </div>
            <div class="aui-toast">
              信息不存在
            </div>
        </div>
    </div>
    <div class="bottom">
        <div class="btn02" onClick="downloadapp();">打开APP查看更多社区动态</div>
    </div>
</body>
<script type="text/template" id="community">
  <div class="swiper-container">
      <div class="swiper-wrapper" >
        {{?null==it.images}}
        <div class="swiper-slide"><img class="slideImage" src="image/pic01.png" /></div>
      {{??}}
      {{~ it.images.split(","):cval:ckey}}
        <div class="swiper-slide"><img class="slideImage" src="{{=cval}}" /></div>
      {{~}}
      {{?}}
      </div>
      <div class="read-num">{{=it.pageView}}阅读</div>
      <div class="swiper-pagination slide-num"></div>
      <div class="mask">&nbsp;</div>
  </div>
    <div id="speakDiv" style="margin-top:12px;">
        <table cellspacing="0" cellpadding="0" style="width:100%;">
            <tr>
                <td width="16">&nbsp;</td>
                <td width="34">
                    {{?null==it.userAvatar}}
                  <img  src="image/logo02.png" class="profile">
                  {{??}}
                  <img  src="{{=it.userAvatar}}" class="profile">
                  {{?}}
                </td>
                <td width="13">&nbsp;</td>
                <td class="userName" >{{=it.nick_name==null?"智慧体育":it.nick_name}}</td>
                <td width="40"><span id="followBtn" class="follow" onClick="downloadapp();">关注</span></td>
                <td width="36">&nbsp;</td>
            </tr>
        </table>
        <table cellspacing="0" cellpadding="0" style="width:100%; margin-top:11px; height:1px;">
            <tr>
                <td width="16"></td>
                <td style="border-top:1px #c9c9c9 solid;"></td>
                <td width="16"></td>
            </tr>
        </table>
        <div id="content" style="width:328px; margin-left:16px; margin-top:11px; font-size:12px; color:#232323; font-family:'微软雅黑';">
            {{=it.content}}
        </div>
        <table cellspacing="0" cellpadding="0" style="width:100%; margin-top:5px;">
            <tr>
                <td width="16">&nbsp;</td>
                <td align="left" class="font01" id="createTime">{{=getDateFormation(it.createTime, 'yyyy-MM-dd')}}</td>
                <td align="right" class="font01">{{=it.pageView}}阅读</td>
                <td width="16">&nbsp;</td>
            </tr>
        </table>
    </div>
    <div id="seperator" class="seperator">&nbsp;</div>
    <table cellspacing="0" cellpadding="0" style="width:100%; height:36px; border-bottom:1px #C9C9C9 solid; background-color:#FFFFFF;">
        <tr>
            <td width="16">&nbsp;</td>
            <td align="left" class="font02">评论</td>
            <td align="right" class="font02">{{=it.commentNum}}人评论</td>
            <td width="16">&nbsp;</td>
        </tr>
    </table>
</script>
<script type="text/template" id="list">
   {{~it:value:index}}
    <table cellspacing="0" cellpadding="0" style="width:100%; margin-top:12px;">
        <tr>
            <td width="16">&nbsp;</td>
            <td width="26" valign="top">
              {{?value.user_avatar==null}}
                <img src="image/logo02.png" class="commentProfile" />
                {{??}}
                <img src="{{=value.user_avatar}}" class="commentProfile" />
                {{?}}
            </td>
            <td width="12">&nbsp;</td>
            <td valign="top">
                <table cellspacing="0" cellpadding="0" style="width:100%;">
                    <tr>
                        <td class="font01">{{=value.nick_name==null?"智慧体育":value.nick_name}}
                        </td>
                        <td width="13"><i class="iconfont" style="font-size:14px; color:#656565">&#xe647;</i></td>
                        <td width="6">&nbsp;</td>
                        <td width="6" class="font01">{{=value.totalGreats}}</td>
                    </tr>
                </table>
                <div class="font01" style="margin-top:2px;">{{=value.comment}}</div>
                <div class="date" style="margin-top:6px;">{{=getDateFormation(value.create_time, 'yyyy-MM-dd')}}</div>
                {{?value.childComment.length > 0}}
                <div class="replyDiv" style="margin-top:10px;">
                  {{~ value.childComment:cval:ckey}}
                  <div class="reply">{{=cval.nick_name}}:{{=cval.comment}}</div>
                  {{~}}

                  {{?value.commentcount>2}}
                  <div class="showAll" onclick="openCommentDetail();">查看全部{{=value.commentcount}}条回复>></div>
                  {{?}}
                </div>
                {{?}}
            </td>
            <td width="16">&nbsp;</td>
        </tr>
    </table>
    {{~}}
</script>
<script type="text/javascript" id="yytDESScript" src="./js/yytdes.js" data="0"></script>
<script type="text/javascript" src="./js/api.js"></script>
<script type="text/javascript" src="./js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="./js/doT.min.js"></script>
<script type="text/javascript" src="./js/common.js"></script>
<script type="text/javascript" src="./js/swiper.min.js"></script>
<script type="text/javascript">
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return 1;
    }
    $(document).ready(function() {
        var id = getQueryVariable("id");
        loadData(id);
        loadComment(id);
    });


    function loadData(id) {
        //获取社区动态详情
        ajaxRequest('sport/forums/info/'+ id, "POST", {}, function(ret, err) {
            if (ret.code == 0) {
                var data = JSON.parse(decryptByDESModeEBC(ret.data)); //解密数据

                //获取会话列表并显示
                var basicInfo = $api.byId('basicInfo');
                // 编译模板函数
                var tempFn = doT.template($api.byId('community').innerHTML);
                // 使用模板函数生成HTML文本
                var resultHTML = tempFn(data.forums);

                $api.append(basicInfo, resultHTML);

                $("title").html(data.forums.nickName==null?"智慧体育的社区动态":data.forums.nickName+"的社区动态");//修改title显示
                /*if (!utils.isNullOrEmpty(ret.forums.images)) {
                  imagesArray=ret.forums.images.split(",");
                }*/
                var swiper = new Swiper('.swiper-container', {
                    autoplay: {
                        stopOnLastSlide: false
                    },
                    pagination: {
                        el: '.swiper-pagination',
                        type: 'fraction',
                    }
                });

            } else {
              $(".aui-toast").show();
              setTimeout(function(){
                  $(".aui-toast").hide();
              }, 2000)
            }
        });

    }
    function loadComment(id) {
      //加载评论信息
          var param='{"forumsId":'+id+'}';
      ajaxRequest('sport/forumscomment/list', "POST", param, function(ret, err) {
          if (ret.code == 0) {
              var data = JSON.parse(decryptByDESModeEBC(ret.data)); //解密数据
              //获取评论列表并显示
              var list = $api.byId('commentDiv');
              // 编译模板函数
              var tempFn = doT.template($api.byId('list').innerHTML);
              // 使用模板函数生成HTML文本
              var resultHTML = tempFn(data.page.list);

              $api.append(list, resultHTML);

          } else {

          }
      });

    }
</script>

</html>
